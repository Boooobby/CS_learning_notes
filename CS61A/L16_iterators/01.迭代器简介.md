# Python 中的迭代器 (Iterator)

迭代器是 Python 中用于遍历集合元素的一种对象，它遵循迭代器协议。

## 迭代器协议

迭代器协议要求对象必须实现两个方法：
1. `__iter__()` - 返回迭代器对象本身
2. `__next__()` - 返回容器中的下一个元素，如果没有更多元素则抛出 `StopIteration` 异常

## 创建迭代器

### 1. 从可迭代对象创建

Python 中许多内置对象都是可迭代的（如列表、元组、字符串、字典等），可以使用 `iter()` 函数获取它们的迭代器：

```python
my_list = [1, 2, 3]
my_iter = iter(my_list)

print(next(my_iter))  # 输出: 1
print(next(my_iter))  # 输出: 2
print(next(my_iter))  # 输出: 3
# print(next(my_iter))  # 抛出 StopIteration 异常
```

### 2. 自定义迭代器类

```python
class Counter:
    def __init__(self, low, high):
        self.current = low
        self.high = high
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current > self.high:
            raise StopIteration
        else:
            self.current += 1
            return self.current - 1

# 使用自定义迭代器
for num in Counter(3, 8):
    print(num)
```

## 迭代器的特点

1. **惰性计算**：迭代器不会一次性生成所有元素，而是在需要时才计算下一个值
2. **一次性使用**：大多数迭代器遍历一次后就不能再次使用
3. **节省内存**：因为不需要一次性存储所有元素

## 生成器 - 创建迭代器的简便方式

生成器是一种特殊的迭代器，使用 `yield` 关键字可以更简单地创建迭代器：

```python
def counter(low, high):
    current = low
    while current <= high:
        yield current
        current += 1

# 使用生成器
for num in counter(3, 8):
    print(num)
```

## 常用内置迭代器工具

Python 的 `itertools` 模块提供了许多有用的迭代器函数：

```python
import itertools

# 无限迭代器
count = itertools.count(10, 2)  # 10, 12, 14, ...
cycle = itertools.cycle('ABC')  # A, B, C, A, B, C, ...
repeat = itertools.repeat(10, 3)  # 10, 10, 10

# 有限迭代器
chain = itertools.chain('ABC', 'DEF')  # A B C D E F
compress = itertools.compress('ABCDEF', [1,0,1,0,1,1])  # A C E F
```

迭代器是 Python 中实现惰性计算和高效内存使用的强大工具，特别适合处理大型数据集或无限序列。