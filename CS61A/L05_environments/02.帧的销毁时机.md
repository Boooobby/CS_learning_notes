在 Python 中，**帧（Frame）** 是执行上下文的基本单位，用于管理函数调用时的局部变量、代码执行位置等信息。帧的销毁时机与作用域（Scope）和对象的生命周期密切相关。以下是帧销毁的具体规则和场景：

---

## **1. 函数帧（Function Frame）的销毁**
当一个函数被调用时，Python 会创建一个新的帧来存储该函数的局部变量和执行状态。**该帧在函数执行完毕后销毁**，除非有特殊情况（如闭包或生成器）。

### **（1）普通函数调用后销毁**
```python
def foo():
    x = 10  # 局部变量，存储在 foo 的帧中
    print(x)

foo()  # 调用 foo，创建帧
# 函数执行完毕，帧被销毁，x 不再存在
```
- **帧何时销毁？**：函数 `return` 或执行到末尾时，其对应的帧立即销毁。
- **局部变量 `x`**：随帧销毁而被回收（如果没有被其他对象引用）。

### **（2）嵌套函数（闭包）可能延长父帧的生命周期**
如果内部函数（闭包）引用了外部函数的变量，则外部函数的帧不会立即销毁，而是会被保留，直到所有闭包都不再使用它：
```python
def outer():
    y = 20  # outer 的局部变量
    def inner():
        print(y)  # inner 引用了 outer 的 y
    return inner

closure = outer()  # outer 执行完毕，但 y 仍被 inner 引用，outer 的帧不会销毁
closure()  # 输出 20
# 直到 closure 被销毁（如 del closure），outer 的帧才会被回收
```
- **帧何时销毁？**：只有当所有引用它的闭包都被销毁后，外部函数的帧才会被回收。

---

## **2. 生成器（Generator）帧的临时挂起**
生成器函数在 `yield` 时会暂停执行，并保留当前帧，直到下次调用 `next()` 或生成器被关闭：
```python
def gen():
    x = 10
    yield x
    y = 20
    yield y

g = gen()  # 创建生成器，首次调用不执行代码
print(next(g))  # 输出 10，此时 gen 的帧被挂起（未销毁）
print(next(g))  # 输出 20，继续执行
# 生成器执行完毕后，帧自动销毁
```
- **帧何时销毁？**：
  - 生成器执行完最后一个 `yield` 或 `return` 后，帧销毁。
  - 如果生成器被提前关闭（`g.close()`）或垃圾回收，帧也会销毁。

---

## **3. 全局帧（Global Frame）的销毁**
全局帧是模块级别的执行环境，**只有在 Python 程序退出或模块被卸载（`del sys.modules[模块名]`）时才会销毁**：
```python
# module.py
x = 10  # 全局变量，存储在模块的全局帧中

def foo():
    print(x)

# 即使 foo 执行完毕，全局帧仍然存在
# 直到程序退出或模块被卸载
```
- **帧何时销毁？**：
  - 程序退出时。
  - 使用 `del sys.modules["module"]` 手动卸载模块时。

---

## **4. 异常处理与帧销毁**
即使发生异常，Python 也会确保帧被正确销毁（类似 `try-finally` 机制）：
```python
def risky():
    x = 10
    raise ValueError("Oops!")
    return x  # 不会执行

try:
    risky()
except ValueError:
    print("Caught error")
# risky 的帧在异常发生后仍然会被销毁
```

---

## **总结：帧的销毁时机**
| **帧类型**       | **销毁时机**                                                                 |
|------------------|-----------------------------------------------------------------------------|
| **普通函数帧**   | 函数执行完毕（`return` 或代码结束）后立即销毁。                               |
| **闭包函数帧**   | 外部函数的帧在所有内部函数（闭包）不再引用它时销毁。                           |
| **生成器帧**     | 生成器执行完最后一个 `yield` 或 `return` 后销毁，或提前关闭/垃圾回收时销毁。  |
| **全局帧**       | 程序退出或模块被卸载时销毁。                                                 |
| **异常导致的帧** | 即使发生异常，帧也会被正确销毁。                                             |

### **关键点**
- **局部变量随帧销毁而回收**（除非被闭包或全局变量引用）。
- **生成器和闭包会延长帧的生命周期**。
- **全局帧几乎不会销毁**（除非程序结束或模块卸载）。

如果有更复杂的场景（如循环引用、`weakref` 等），可以进一步探讨！