# Python 列表推导式（List Comprehension）详解

列表推导式是 Python 中一种优雅且高效的方式来创建列表，它可以用简洁的语法替代传统的 `for` 循环加 `append()` 的模式。

## 基本语法

```python
[expression for item in iterable]
```

等价于：

```python
result = []
for item in iterable:
    result.append(expression)
```

### 简单示例

```python
# 生成 0-9 的平方列表
squares = [x**2 for x in range(10)]
# 结果: [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
```

## 带条件的列表推导式

### 1. 添加条件判断（if 在最后）

```python
[expression for item in iterable if condition]
```

示例：

```python
# 只保留偶数
evens = [x for x in range(10) if x % 2 == 0]
# 结果: [0, 2, 4, 6, 8]
```

### 2. 条件表达式（类似三元运算）

```python
[expression_if_true if condition else expression_if_false for item in iterable]
```

示例：

```python
# 将奇数标记为'odd'，偶数保持原样
numbers = ['odd' if x % 2 else x for x in range(5)]
# 结果: [0, 'odd', 2, 'odd', 4]
```

## 嵌套列表推导式

### 1. 嵌套循环

```python
[expression for item1 in iterable1 for item2 in iterable2]
```

示例：

```python
# 生成乘法表
multiplication = [i * j for i in range(1, 4) for j in range(1, 4)]
# 结果: [1, 2, 3, 2, 4, 6, 3, 6, 9]
```

### 2. 嵌套的列表推导式

```python
# 将二维矩阵展平
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flattened = [num for row in matrix for num in row]
# 结果: [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

## 高级用法

### 1. 多重条件

```python
# 10以内能被2或3整除的数
nums = [x for x in range(10) if x % 2 == 0 or x % 3 == 0]
# 结果: [0, 2, 3, 4, 6, 8, 9]
```

### 2. 函数应用

```python
# 对列表中的字符串进行处理
words = [' hello ', ' world ']
stripped = [word.strip().upper() for word in words]
# 结果: ['HELLO', 'WORLD']
```

### 3. 字典和集合推导式

同样的概念也适用于字典和集合：

```python
# 字典推导式
square_dict = {x: x**2 for x in range(5)}
# 结果: {0: 0, 1: 1, 2: 4, 3: 9, 4: 16}

# 集合推导式
unique_lengths = {len(word) for word in ['hello', 'world', 'python']}
# 结果: {5, 6}
```

## 性能考虑

列表推导式通常比等效的 `for` 循环更快，因为：
1. 解释器可以优化列表推导式的执行
2. 减少了方法调用（如 `append()`）的开销

但对于非常复杂的逻辑，使用普通循环可能更易读。

## 何时避免使用

1. **可读性差时**：如果推导式变得太长或太复杂，考虑使用普通循环
2. **需要副作用时**：推导式应该专注于创建新列表，而不是执行操作
3. **内存敏感场景**：对于大数据集，考虑使用生成器表达式（用圆括号）

## 生成器表达式

与列表推导式类似，但使用圆括号并返回生成器（惰性求值）：

```python
# 生成器表达式
squares_gen = (x**2 for x in range(10))
print(next(squares_gen))  # 0
print(next(squares_gen))  # 1
```

列表推导式是 Python 中非常强大的特性，合理使用可以使代码更简洁、更 Pythonic。