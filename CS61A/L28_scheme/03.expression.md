好的，我们来深入探讨 Scheme 中的表达式（Expression）。这是理解 Scheme 乃至所有 Lisp 语言的核心。

## 1. 表达式的核心概念

在 Scheme 中，**一切皆是表达式**。这意味着：
- 每个表达式都会**返回一个值**
- 表达式可以嵌套在其他表达式中
- 没有"语句"和"表达式"的区分

## 2. 基本表达式类型

### 2.1 自求值表达式
这些表达式求值后就是它们自身：

```scheme
123          ; → 123 (数字)
#t           ; → #t (布尔真)
#f           ; → #f (布尔假)
"hello"      ; → "hello" (字符串)
'()          ; → () (空列表)
```

### 2.2 变量引用
变量名本身就是一个表达式，求值后会得到该变量绑定的值：

```scheme
(define x 10)
(define y 20)

x           ; → 10
y           ; → 20
(+ x y)     ; → 30 (这里x和y都是变量引用)
```

### 2.3 过程调用（函数调用）
**这是 Scheme 中最常见的表达式形式：**

```scheme
;; 语法: (operator operand1 operand2 ...)

(+ 2 3)             ; → 5
(* 4 (+ 2 3))       ; → 20 (嵌套表达式)
(max 1 5 3 2)       ; → 5
(display "hello")   ; 输出 "hello"，返回未定义值
```

### 2.4 特殊形式
特殊形式看起来像过程调用，但有特殊的求值规则：

#### `define` - 定义变量或函数
```scheme
;; 定义变量
(define pi 3.14159)

;; 定义函数
(define (square x) (* x x))

;; 等价于
(define square (lambda (x) (* x x)))
```

#### `lambda` - 创建匿名函数
```scheme
(lambda (x) (* x x))           ; 一个平方函数
((lambda (x) (* x x)) 5)       ; → 25 (立即调用)

;; 多参数
(lambda (x y) (+ (* x x) (* y y)))
```

#### `if` - 条件判断
```scheme
;; 语法: (if test consequent alternative)
(if (> 5 3)
    "yes"      ; 如果为真返回这个
    "no")      ; 如果为假返回这个

(if #f "true" "false")  ; → "false"
```

#### `cond` - 多条件判断
```scheme
(define (grade score)
  (cond ((>= score 90) 'A)
        ((>= score 80) 'B)
        ((>= score 70) 'C)
        (else 'F)))

(grade 85)  ; → B
```

#### `let` - 局部绑定
```scheme
;; 创建局部变量
(let ((x 5)
      (y 10))
  (+ x y))  ; → 15

;; let* - 顺序绑定（后面的可以引用前面的）
(let* ((x 5)
       (y (* x 2)))
  (+ x y))  ; → 15
```

#### `quote` 或 `'` - 防止求值
```scheme
'(a b c)        ; → (a b c) (列表，不求值)
'(+ 2 3)        ; → (+ 2 3) (列表，不是5)
(quote hello)   ; → hello (符号)
```

#### `set!` - 赋值（修改已有变量）
```scheme
(define counter 0)
(set! counter (+ counter 1))  ; counter 现在为 1
```

## 3. 表达式求值规则

Scheme 使用 **应用序求值**（Applicative Order Evaluation）：

1. **求值所有子表达式**
2. **应用操作符到操作数**

### 求值过程示例：
```scheme
(* (+ 2 3) (- 5 2))
```
1. 求值 `*` → 乘法过程
2. 求值 `(+ 2 3)` → 5
3. 求值 `(- 5 2)` → 3
4. 应用 `*` 到 5 和 3 → 15

## 4. 特殊形式的求值

特殊形式不遵循常规的求值规则：

### `if` 的求值：
```scheme
(if (> 3 2)
    (+ 1 2)
    (/ 1 0))  ; 这里不会求值，因为条件为真
```

### `and`/`or` 的短路求值：
```scheme
(and (> 3 2) (< 5 4) (/ 1 0))  ; → #f，在(< 5 4)处停止
(or (< 3 2) (> 5 4) (/ 1 0))   ; → #t，在(> 5 4)处停止
```

## 5. 表达式序列

使用 `begin` 来组合多个表达式，按顺序求值，返回最后一个表达式的值：

```scheme
(begin
  (display "Hello")
  (newline)
  (+ 2 3))  ; → 5，同时输出 "Hello" 和新行
```

很多特殊形式（如 `lambda`、`let` 的函数体）都隐含有 `begin`：

```scheme
(define (test x)
  (display "Calculating...")
  (newline)
  (* x x))  ; 函数体包含多个表达式
```

## 6. 定义新的表达式

通过宏可以创建新的语法形式：

```scheme
;; 定义一个 unless 宏
(define-syntax unless
  (syntax-rules ()
    ((unless test expr ...)
     (if (not test)
         (begin expr ...)))))

;; 使用新表达式
(unless (> 5 10)
  (display "5 is not greater than 10")
  (newline))
```

## 7. 表达式的类型判断

Scheme 提供了一系列谓词来判断表达式的类型：

```scheme
(number? 123)      ; → #t
(string? "hello")  ; → #t
(procedure? +)     ; → #t
(list? '(a b c))   ; → #t
(symbol? 'hello)   ; → #t
```

## 8. 实际示例

### 阶乘函数
```scheme
(define (factorial n)
  (if (<= n 1)
      1
      (* n (factorial (- n 1)))))
```

### 列表处理
```scheme
(define (sum-list lst)
  (if (null? lst)
      0
      (+ (car lst) (sum-list (cdr lst)))))
```

### 高阶函数
```scheme
(define (map f lst)
  (if (null? lst)
      '()
      (cons (f (car lst)) (map f (cdr lst)))))
```

## 总结

Scheme 表达式的特点：

| 特性 | 说明 |
|------|------|
| **一致性** | 所有代码都用统一的 S-表达式表示 |
| **表达式导向** | 每个表达式都返回一个值 |
| **嵌套性** | 表达式可以自由嵌套 |
| **应用序求值** | 先求值参数，再应用函数 |
| **特殊形式** | 有特殊的求值规则 |
| **一等公民的函数** | 函数可以像数据一样被创建和传递 |

理解 Scheme 表达式是掌握函数式编程和元编程概念的关键。这种统一的表达方式虽然开始时需要适应，但一旦掌握，就会体会到其强大的表达能力和灵活性。