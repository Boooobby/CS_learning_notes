# Python 类属性与实例属性详解

在 Python 面向对象编程中，类属性和实例属性是两种重要的属性类型，它们在使用方式和作用范围上有显著区别。

## 一、基本概念对比

| 特性            | 类属性 (Class Attribute)               | 实例属性 (Instance Attribute)         |
|----------------|----------------------------------------|--------------------------------------|
| **定义位置**     | 类定义内部，方法外部                    | `__init__` 或其他实例方法内部         |
| **访问方式**     | 类和实例均可访问                        | 只能通过实例访问                      |
| **内存存储**     | 类对象中存储一份                        | 每个实例存储独立副本                  |
| **修改影响**     | 影响所有实例                            | 只影响当前实例                        |
| **典型用途**     | 类级别的常量、计数器等共享数据           | 实例特有的数据                        |

## 二、类属性详解

### 1. 定义与访问
```python
class Employee:
    company = "ABC Corp"  # 类属性
    
    def __init__(self, name):
        self.name = name  # 实例属性

# 通过类访问
print(Employee.company)  # 输出: ABC Corp

# 通过实例访问
emp1 = Employee("Alice")
print(emp1.company)     # 输出: ABC Corp
```

### 2. 修改类属性
```python
Employee.company = "XYZ Inc"  # 修改类属性
emp2 = Employee("Bob")
print(emp1.company)  # 输出: XYZ Inc (所有实例受影响)
print(emp2.company)  # 输出: XYZ Inc
```

### 3. 类属性作为默认值
```python
class Circle:
    PI = 3.14159  # 类属性作为常量
    
    def __init__(self, radius):
        self.radius = radius
    
    def area(self):
        return self.PI * self.radius ** 2
```

## 三、实例属性详解

### 1. 定义与访问
```python
class Person:
    def __init__(self, name, age):
        self.name = name  # 实例属性
        self.age = age     # 实例属性

p1 = Person("Alice", 25)
p2 = Person("Bob", 30)

print(p1.name)  # Alice (独立)
print(p2.name)  # Bob (独立)
```

### 2. 动态添加实例属性
```python
p1.email = "alice@example.com"  # 运行时添加
print(p1.email)  # 有效
# print(p2.email)  # 报错，AttributeError
```

## 四、关键区别与注意事项

### 1. 访问优先级
```python
class Test:
    attr = "类属性"  # 类属性
    
    def __init__(self):
        self.attr = "实例属性"  # 同名实例属性

t = Test()
print(t.attr)  # 输出: "实例属性" (实例属性优先)
print(Test.attr)  # 输出: "类属性"
```

### 2. 修改陷阱
```python
class Counter:
    count = 0  # 类属性
    
    def __init__(self):
        self.count += 1  # 实际创建了实例属性!

c1 = Counter()
print(c1.count)  # 1 (实例属性)
print(Counter.count)  # 0 (类属性未变)

c2 = Counter()
print(c2.count)  # 1
print(Counter.count)  # 0
```

正确修改类属性的方式：
```python
class CorrectCounter:
    count = 0
    
    def __init__(self):
        CorrectCounter.count += 1  # 显式指定类

cc1 = CorrectCounter()
print(cc1.count)  # 1
print(CorrectCounter.count)  # 1
```

## 五、高级用法

### 1. 使用 `__class__` 访问类属性
```python
class MyClass:
    class_attr = 42
    
    def print_class_attr(self):
        print(self.__class__.class_attr)  # 通过__class__访问
```

### 2. 类属性与继承
```python
class Parent:
    class_value = "Parent"
    
class Child(Parent):
    class_value = "Child"  # 覆盖父类属性

print(Parent.class_value)  # Parent
print(Child.class_value)   # Child
```

### 3. 使用 `__slots__` 优化实例属性
```python
class Optimized:
    __slots__ = ['x', 'y']  # 限制实例属性
    
    def __init__(self, x, y):
        self.x = x
        self.y = y

o = Optimized(1, 2)
# o.z = 3  # 报错，不允许动态添加属性
```

## 六、最佳实践

1. **明确区分用途**：
   - 类属性：用于类级别的数据和常量
   - 实例属性：用于实例特有的数据

2. **命名约定**：
   - 类属性：通常使用全大写命名常量 (如 `MAX_SIZE`)
   - 实例属性：使用小写字母和下划线 (如 `student_name`)

3. **避免陷阱**：
   - 修改类属性时使用 `ClassName.attr` 语法
   - 警惕同名实例属性覆盖类属性

4. **合理使用**：
   ```python
   class Configuration:
       DEFAULT_TIMEOUT = 10  # 类属性作为配置
       
       def __init__(self, custom_timeout=None):
           self.timeout = custom_timeout or self.DEFAULT_TIMEOUT  # 实例属性
   ```

理解类属性和实例属性的区别与联系，能够帮助您设计出更加清晰、高效的面向对象 Python 程序。