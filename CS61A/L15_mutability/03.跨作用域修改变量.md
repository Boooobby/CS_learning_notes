在 Python 中，`nonlocal` 和 `global` 是用于在 **嵌套函数** 或 **全局作用域** 中修改变量的关键字。它们的作用是 **明确指定变量的作用域**，避免因变量遮蔽（Variable Shadowing）导致的意外行为。

---

## **1. `global`：修改全局变量**
### **作用**
- 在 **函数内部** 修改 **全局变量**（而不是创建一个新的局部变量）。
- 如果不使用 `global`，函数内对变量的赋值会默认创建 **局部变量**。

### **语法**
```python
global 变量名
```

### **示例**
#### **(1) 不使用 `global`（默认创建局部变量）**
```python
x = 10  # 全局变量

def foo():
    x = 20  # 这里创建的是局部变量，不影响全局 x
    print("Inside:", x)  # 输出: Inside: 20

foo()
print("Outside:", x)  # 输出: Outside: 10（全局 x 未被修改）
```

#### **(2) 使用 `global` 修改全局变量**
```python
x = 10  # 全局变量

def foo():
    global x  # 声明 x 是全局变量
    x = 20    # 直接修改全局 x
    print("Inside:", x)  # 输出: Inside: 20

foo()
print("Outside:", x)  # 输出: Outside: 20（全局 x 被修改）
```

---

## **2. `nonlocal`：修改闭包中的外层变量**
### **作用**
- 在 **嵌套函数** 中修改 **外层（非全局）变量**。
- 如果不使用 `nonlocal`，内层函数会默认创建 **新的局部变量**。

### **语法**
```python
nonlocal 变量名
```

### **示例**
#### **(1) 不使用 `nonlocal`（默认创建局部变量）**
```python
def outer():
    x = 10  # 外层函数的局部变量

    def inner():
        x = 20  # 这里创建的是 inner 的局部变量，不影响 outer 的 x
        print("Inner:", x)  # 输出: Inner: 20

    inner()
    print("Outer:", x)  # 输出: Outer: 10（外层 x 未被修改）

outer()
```

#### **(2) 使用 `nonlocal` 修改外层变量**
```python
def outer():
    x = 10  # 外层函数的局部变量

    def inner():
        nonlocal x  # 声明 x 是外层函数的变量
        x = 20     # 直接修改 outer 的 x
        print("Inner:", x)  # 输出: Inner: 20

    inner()
    print("Outer:", x)  # 输出: Outer: 20（外层 x 被修改）

outer()
```

---

## **3. `global` vs `nonlocal` 对比**
| 关键字      | 作用域               | 用途                          | 示例                          |
|------------|----------------------|-------------------------------|-------------------------------|
| `global`   | **全局作用域**       | 在函数内修改全局变量          | `global x; x = 10`            |
| `nonlocal` | **闭包作用域**       | 在嵌套函数内修改外层变量      | `nonlocal x; x = 10`          |

---

## **4. 关键注意事项**
1. **`global` 用于全局变量**：
   - 如果全局变量不存在，`global` 会在函数执行时创建它。
   ```python
   def foo():
       global y  # 如果 y 不存在，会在赋值时创建
       y = 10

   foo()
   print(y)  # 输出: 10
   ```

2. **`nonlocal` 必须用于已存在的外层变量**：
   - 如果外层没有该变量，会报错 `SyntaxError: no binding for nonlocal 'x' found`。
   ```python
   def outer():
       def inner():
           nonlocal x  # 报错！外层没有 x
           x = 10
       inner()
   ```

3. **不能同时用 `global` 和 `nonlocal`**：
   - 一个变量不能既是全局的又是非局部的。

4. **优先使用函数参数代替 `global`/`nonlocal`**：
   - 过度使用 `global` 和 `nonlocal` 会导致代码难以维护，建议用返回值或参数传递数据。
   ```python
   # 更好的方式（避免 global）
   def foo(x):
       x += 1
       return x

   x = 10
   x = foo(x)  # 显式传递和接收
   ```

---

## **5. 经典应用场景**
### **(1) `global` 用于全局配置**
```python
DEBUG = False

def set_debug(flag):
    global DEBUG
    DEBUG = flag

set_debug(True)
print(DEBUG)  # 输出: True
```

### **(2) `nonlocal` 用于闭包计数器**
```python
def counter():
    count = 0

    def increment():
        nonlocal count
        count += 1
        return count

    return increment

c = counter()
print(c())  # 输出: 1
print(c())  # 输出: 2
```

---

## **6. 总结**
- **`global`**：在函数内修改 **全局变量**。
- **`nonlocal`**：在嵌套函数内修改 **外层变量**。
- 谨慎使用，优先考虑 **函数参数和返回值** 传递数据。
- 错误使用会导致变量遮蔽（Shadowing）或意外修改。