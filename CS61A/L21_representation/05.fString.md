### **Python 的 f-string（格式化字符串）详解**
f-string（formatted string literals，格式化字符串字面量）是 Python 3.6 引入的一种**字符串格式化语法**，它允许在字符串中**直接嵌入表达式**，简洁高效。相比传统的 `%` 格式化和 `str.format()`，f-string 更直观、易读，并且性能更好。

---

## **1. f-string 的基本语法**
在字符串前加 `f` 或 `F`，并用 `{}` 包裹表达式：
```python
name = "Alice"
age = 25
message = f"My name is {name} and I am {age} years old."
print(message)
# 输出: My name is Alice and I am 25 years old.
```

---

## **2. f-string 的核心特性**
### **2.1 支持任意表达式**
`{}` 内可以是变量、运算、函数调用等：
```python
a, b = 3, 5
print(f"{a} + {b} = {a + b}")  # 输出: 3 + 5 = 8

def greet(name):
    return f"Hello, {name}!"

print(f"{greet('Bob')}")  # 输出: Hello, Bob!
```

### **2.2 自动类型转换**
无需手动调用 `str()`，f-string 会自动转换类型：
```python
price = 19.99
print(f"Price: {price}")  # 输出: Price: 19.99
```

### **2.3 支持多行字符串**
用三引号 `"""` 包裹多行 f-string：
```python
user = {"name": "Alice", "age": 25}
text = f"""
User Info:
  Name: {user['name']}
  Age:  {user['age']}
"""
print(text)
# 输出:
# User Info:
#   Name: Alice
#   Age:  25
```

---

## **3. f-string 的高级用法**
### **3.1 格式化控制**
在 `{}` 内使用 `:` 指定格式（如小数位数、对齐等）：
```python
pi = 3.1415926
print(f"Pi: {pi:.2f}")      # 输出: Pi: 3.14（保留2位小数）
print(f"Hex: {255:#x}")     # 输出: Hex: 0xff（十六进制）
print(f"Percent: {0.25:.0%}")  # 输出: Percent: 25%（百分比）
```

#### **常用格式说明符**
| 格式       | 示例                | 输出              |
|------------|---------------------|-------------------|
| `:.2f`     | `3.1415926:.2f`     | `3.14`            |
| `:>10`     | `"text":>10`        | `"      text"`（右对齐） |
| `:<10`     | `"text":<10`        | `"text      "`（左对齐） |
| `:^10`     | `"text":^10`        | `"   text   "`（居中） |
| `:,`       | `1000000:,`         | `1,000,000`（千位分隔符） |

### **3.2 直接调用方法或属性**
```python
name = "alice"
print(f"{name.upper()}")  # 输出: ALICE

import datetime
now = datetime.datetime.now()
print(f"Today: {now:%Y-%m-%d}")  # 输出: Today: 2023-01-01
```

### **3.3 嵌套花括号**
如果需要显示字面量的 `{` 或 `}`，需双写：
```python
print(f"{{}} is a curly brace")  # 输出: {} is a curly brace
```

### **3.4 调试变量（Python 3.8+）**
使用 `=` 直接输出变量名和值（调试专用）：
```python
x = 10
print(f"{x=}")  # 输出: x=10
```

---

## **4. f-string 的性能优势**
f-string 在运行时直接计算并嵌入表达式，比 `%` 和 `str.format()` 更快：
```python
# 性能对比
import timeit

timeit.timeit('f"Hello, {name}"', setup='name="Alice"')          # 约 0.1s
timeit.timeit('"Hello, {}".format(name)', setup='name="Alice"')  # 约 0.2s
timeit.timeit('"Hello, %s" % name', setup='name="Alice"')        # 约 0.15s
```

---

## **5. f-string 的限制**
1. **不能包含反斜杠 `\`**（如换行符 `\n` 需用变量代替）：
   ```python
   # 错误示例
   # print(f"Line 1\nLine 2")  # SyntaxError

   # 正确做法
   nl = "\n"
   print(f"Line 1{nl}Line 2")
   ```
2. **Python 3.6+ 才支持**，旧版本需升级或使用其他格式化方法。

---

## **6. 对比其他格式化方法**
| 方法          | 示例                          | 特点                               |
|---------------|-------------------------------|-----------------------------------|
| **f-string**  | `f"{name} is {age} years old"` | 最简洁，性能最佳（Python 3.6+）    |
| `str.format`  | `"{} is {} years old".format(name, age)` | 兼容旧版本，稍显冗长              |
| `%` 格式化    | `"%s is %d years old" % (name, age)` | 最古老，不推荐在新代码中使用       |

---

## **7. 最佳实践**
1. **优先使用 f-string**（Python 3.6+ 项目）。
2. **复杂格式用 `:` 控制**（如 `{value:.2f}`）。
3. **避免拼接敏感数据**（如 SQL 查询应使用参数化查询，而非 f-string）。

---

## **8. 总结**
- **f-string 是 Python 最推荐的字符串格式化方式**，兼顾简洁性、可读性和性能。
- **核心语法**：`f"Text {expression}"`，支持任意表达式和格式化控制。
- **适用场景**：日志输出、动态文本生成、调试等。

通过掌握 f-string，你可以写出更优雅、高效的 Python 代码！