这部分是对 **“字节填充”** 具体操作规则和过程的完美图示。让我结合这两张图为你彻底讲明白这个关键技术。

---

### **1. 字节填充（字符填充）的核心规则**

这个技术是为了解决 **“数据内容与帧边界标志冲突”** 的问题。

**三条核心转义规则：**
1.  **转义标志字节**
    - **原始数据中遇到**：`0x7E`（标志字节）
    - **替换为**：`0x7D` `0x5E`
    - **解释**：`0x7D` 是转义字节（ESC），`0x5E` 是 `0x7E` 与 `0x20` 进行异或运算后的结果（即 `7E ^ 20 = 5E`）。这样组合后，接收方看到 `7D 5E` 就知道要恢复为 `7E`。

2.  **转义转义字节本身**
    - **原始数据中遇到**：`0x7D`（转义字节本身）
    - **替换为**：`0x7D` `0x5D`
    - **解释**：`0x5D` 是 `0x7D` 与 `0x20` 进行异或运算后的结果（`7D ^ 20 = 5D`）。防止接收方将数据中的 `0x7D` 误认为是转义序列的开始。

3.  **转义控制字符**（可选，但常见）
    - **原始数据中遇到**：值小于 `0x20` 的ASCII控制字符（如 `0x01` SOH, `0x04` EOT等）
    - **替换为**：`0x7D` `[原字节与0x20异或后的值]`
    - **解释**：防止这些控制字符在异步串行线路上被误解为传输控制信号。例如，`0x01`（SOH）会被转换为 `0x7D 0x21`（因为 `01 ^ 20 = 21`）。

### **2. 图示过程详解**

第二张图生动地展示了字节填充的完整过程。我们一步步来看：

**假设：**
- **帧开始符/结束符** = `0x7E`（但在图中，为了通用演示，它使用了 `SOH` 和 `EOT` 作为特殊控制字符的例子）。
- **转义字节（ESC）** = `0x7D`。

**原始数据**（要发送的净荷数据）：
```
SOH, EOT, SOH, ESC, SOH, EOT
```
（注意：这里的 `SOH`, `EOT`, `ESC` 都是数据内容的一部分，不是帧控制符）

**填充过程（发送方）：**
1.  **遇到第一个 `SOH`**：它是需要转义的控制字符（值 < 0x20）。将其替换为 `ESC` + `[SOH ^ 0x20]` → **`ESC EOT`**。
    *（注：这里图中用 `EOT` 代表 `SOH ^ 0x20` 的结果，实际值取决于运算）*

2.  **遇到第一个 `EOT`**：它也是需要转义的控制字符。将其替换为 `ESC` + `[EOT ^ 0x20]` → **`ESC SOH`**。

3.  **遇到第二个 `SOH`**：同样转义 → **`ESC EOT`**。

4.  **遇到 `ESC`（转义字符本身）**：根据规则，需要转义它自身。将其替换为 `ESC` + `[ESC ^ 0x20]` → **`ESC ESC`**。
    *（这是关键一步，防止接收方将数据中的ESC误认为是转义序列）*

5.  **遇到第三个 `SOH`**：转义 → **`ESC EOT`**。

6.  **遇到第二个 `EOT`**：转义 → **`ESC SOH`**。

**最终，经过字节填充后要发送的数据序列变为：**
```
帧开始符, ESC EOT, ESC SOH, ESC EOT, ESC ESC, ESC EOT, ESC SOH, 帧结束符
```

**接收方的逆过程：**
接收方从左到右读取数据：
- 看到 `帧开始符`：知道新帧开始。
- 看到 `ESC`：意识到下一个字节是**被转义的**。
    - 若下一个是 `EOT`，则计算出原始字节 = `EOT ^ 0x20` = `SOH`，恢复出 `SOH`。
    - 若下一个是 `SOH`，则恢复出 `EOT`。
    - 若下一个还是 `ESC`，则恢复出单个 `ESC`。
- 如此反复，直到遇到 `帧结束符`，成功恢复出完整的原始数据。

### **3. 为什么需要字节填充？**

**根本原因：** 为了保证**帧的透明传输**。
- **透明传输**：指数据链路层对上层交付的传输数据没有任何限制，即使数据中出现了与控制字符（如帧定界符）完全一样的比特组合，也能正确传输。
- **字节填充**就是实现透明传输的经典方法。它在数据中“嵌入”的特殊字节，就像是给数据中的“危险字符”贴上了“这是内容，不是指令”的标签。

### **总结与对比**

- **比特填充（HDLC使用）**：在数据中每出现 **5个连续的“1”** 后，自动插入一个“0”。接收方则删除每5个“1”后的“0”。用于面向比特的同步链路。
- **字节填充（PPP使用）**：使用一个特殊的**转义字节（ESC）** 来标记数据中出现的控制字符。用于面向字节的异步链路（如拨号Modem）。

**简单比喻：**
想象你要邮寄一幅画，画里恰好有邮局的专用印章图案。
- **字节填充**就像是你在这幅画的印章图案旁，用铅笔轻轻写上一个小字条：“此图案为画作内容，非真实印章”。
- **邮差（接收方）** 看到字条，就明白这个图案不是邮局的指令，只是画的一部分。他把字条擦掉（移除转义字节），将完整的画作（原始数据）交给收件人。

掌握了字节填充，你就理解了PPP如何在一条简单的串行链路上，可靠地传输**任意内容**的数据包，这是数据链路层的一项基础且重要的技术。