# **通俗易懂的 `chmod` 权限管理指南**

`chmod` 是 Linux/Unix 中用来修改文件或目录权限的命令，但它的手册 (`man chmod`) 对新手可能不太友好。下面我用最直观的方式解释它的用法。

---

## **1. 权限基础：三组权限**
每个文件/目录有三组权限，分别对应三种用户身份：

| 用户身份 | 符号表示 | 说明               |
|----------|----------|--------------------|
| **用户(User)**   | `u`      | 文件所有者         |
| **用户组(Group)** | `g`      | 文件所属组的成员   |
| **其他用户(Others)** | `o`      | 其他所有用户       |
| **全部(All)** | `a`      | 以上所有身份       |

每组权限由三个字符表示（顺序固定）：
- `r` = 读 (Read)
- `w` = 写 (Write)
- `x` = 执行 (eXecute)
- `-` = 无权限

**示例：**  
`-rwxr-xr--` 表示：
- 用户可读、写、执行 (`rwx`)
- 用户组可读、执行 (`r-x`)
- 其他用户仅可读 (`r--`)

---

## **2. 两种修改权限的方法**
### **方法1：符号模式（直观）**
**语法：**  
`chmod [谁][操作][权限] 文件名`

**操作符：**
- `+` 添加权限
- `-` 移除权限
- `=` 精确设置权限

**示例：**
```bash
chmod u+x script.sh    # 给用户添加执行权限
chmod g-w file.txt    # 移除用户组的写权限
chmod o=r file.txt    # 设置其他用户仅可读
chmod a=rwx dir/      # 所有人可读、写、执行（慎用！）
```

### **方法2：数字模式（高效）**
用 **3位八进制数** 表示权限（每位对应 `u/g/o`）：

| 权限 | 二进制 | 数字 |
|------|--------|------|
| `---` | 000    | 0    |
| `--x` | 001    | 1    |
| `-w-` | 010    | 2    |
| `-wx` | 011    | 3    |
| `r--` | 100    | 4    |
| `r-x` | 101    | 5    |
| `rw-` | 110    | 6    |
| `rwx` | 111    | 7    |

**常用组合：**
```bash
chmod 755 script.sh   # u=rwx, g=rx, o=rx（常用可执行文件）
chmod 644 file.txt   # u=rw, g=r, o=r（普通文件）
chmod 700 ~/.ssh/    # 仅用户可访问（安全目录）
```

---

## **3. 关键注意事项**
### **(1) 目录 vs 文件权限**
| 权限 | 对文件的影响           | 对目录的影响           |
|------|------------------------|------------------------|
| `r`  | 读取文件内容           | 列出目录内容（需 `x` 配合） |
| `w`  | 修改文件内容           | 创建/删除目录内文件（需 `x` 配合） |
| `x`  | 执行程序/脚本          | 进入目录（`cd`）或访问子文件 |

**目录的 `x` 权限是核心**：没有它，`r` 和 `w` 权限无效！

### **(2) 递归修改（`-R` 选项）**
```bash
chmod -R 755 mydir/  # 修改目录及其内部所有内容
```
⚠️ 慎用！错误权限可能导致系统安全问题。

### **(3) 特殊权限**
| 符号 | 数字 | 作用                     | 示例                     |
|------|------|--------------------------|--------------------------|
| `s` (SUID) | 4000 | 文件运行时以所有者权限执行 | `chmod u+s /usr/bin/passwd` |
| `s` (SGID) | 2000 | 目录下新建文件继承组权限   | `chmod g+s /shared_dir`    |
| `t` (Sticky Bit) | 1000 | 仅文件所有者可删除自己的文件 | `chmod +t /tmp`          |

---

## **4. 常见问题解答**
### **Q1: 为什么 `chmod +x` 后脚本仍无法执行？**
- 检查 Shebang 是否正确（如 `#!/bin/bash`）。
- 确保文件不是 Windows 格式（用 `dos2unix` 转换）。

### **Q2: 如何恢复误操作的权限？**
- 目录默认权限：`755`
- 文件默认权限：`644`
- 用 `umask` 查看当前默认权限掩码。

### **Q3: `chmod 777` 安全吗？**
❌ **不安全！** 它允许所有用户修改文件，仅限临时调试使用。

---

## **5. 速查表**
| 需求                  | 符号模式              | 数字模式 |
|-----------------------|-----------------------|----------|
| 用户可读/写/执行      | `chmod u=rwx`         | `700`    |
| 所有人可读/执行       | `chmod a=rx`          | `555`    |
| 移除其他用户的写权限  | `chmod o-w`           | -        |
| 递归设置目录权限      | `chmod -R 755 dir/`   | -        |

记住：权限是 Linux 安全的第一道防线，合理设置是关键！ 🔐