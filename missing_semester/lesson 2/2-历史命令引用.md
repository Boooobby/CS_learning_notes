在 Linux Shell 中，`!!` 是一个**特殊的历史命令引用符号**，表示**重复执行上一条命令**。它是 Shell（如 Bash、Zsh）历史扩展功能的一部分，可以快速调用并重新运行最近执行的命令。

---

## **1. 基本用法**
### **直接执行 `!!`**
- 输入 `!!` 后按回车，会立即重新执行上一条命令：
  ```bash
  $ apt update
  Permission denied（权限不足）
  
  $ sudo !!
  sudo apt update  # 自动替换为 `sudo + 上一条命令`
  ```

### **与其他命令组合**
- `!!` 可以与其他命令结合使用：
  ```bash
  $ echo "Hello"
  Hello
  
  $ !! > output.txt  # 将上一条命令的输出重定向到文件
  ```

---

## **2. 高级用法**
### **`!-n`：执行前 n 条命令**
- `!-1` = `!!`（上一条命令）
- `!-2`：执行倒数第二条命令：
  ```bash
  $ ls
  $ pwd
  $ !-2  # 重新执行 `ls`
  ```

### **`!:n`：引用上一条命令的第 n 个参数**
- `!:0` = 命令本身（如 `apt`）
- `!:1` = 第一个参数（如 `update`）
  ```bash
  $ apt install nginx
  $ echo !:1  # 输出 "install"
  ```

### **`!$` 和 `!^`**
- `!$` = 上一条命令的**最后一个参数**：
  ```bash
  $ touch file.txt
  $ vim !$  # 等同于 `vim file.txt`
  ```
- `!^` = 上一条命令的**第一个参数**：
  ```bash
  $ cp file1.txt file2.txt
  $ cat !^  # 等同于 `cat file1.txt`
  ```

### **`!pattern`：执行最近匹配 `pattern` 的命令**
- 执行最近以 `apt` 开头的命令：
  ```bash
  $ !apt  # 重新执行最近的 `apt ...` 命令
  ```

---

## **3. 安全提示**
- `!!` 会**直接执行上一条命令**，如果上一条是危险操作（如 `rm -rf /`），可能会造成严重后果。
- 可以先按 `Ctrl+P` 或 `↑` 查看历史命令，确认后再执行。

---

## **4. 其他 Shell 的历史扩展**
| 符号 | 作用 | 示例 |
|------|------|------|
| `!!` | 上一条命令 | `sudo !!` |
| `!-n` | 倒数第 n 条命令 | `!-2` |
| `!:n` | 上一条命令的第 n 个参数 | `echo !:1` |
| `!$` | 上一条命令的最后一个参数 | `vim !$` |
| `!^` | 上一条命令的第一个参数 | `cat !^` |
| `!pattern` | 执行最近匹配 `pattern` 的命令 | `!git` |

---

## **5. 禁用历史扩展**
如果不想使用 `!!` 这类功能，可以关闭 Shell 的历史扩展：
```bash
set +H  # 关闭历史扩展（Bash）
set -H  # 重新启用
```

---

## **总结**
- `!!` 是 Shell 中非常实用的快捷方式，特别适合：
  - 快速修复权限问题（`sudo !!`）
  - 重复执行长命令
  - 提取上一条命令的参数（`!$`, `!^`）
- 使用时需谨慎，避免误执行危险命令。