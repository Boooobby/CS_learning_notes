# Shell脚本中的分支和循环结构

Shell脚本提供了多种控制结构来实现分支和循环逻辑，这些是编写复杂脚本的基础。下面我将详细介绍Shell中的分支和循环结构。

## 分支结构

### 1. if语句

基本语法：
```bash
if [ 条件 ]; then
    # 条件为真时执行的命令
fi
```

示例：
```bash
if [ "$1" -gt 10 ]; then
    echo "参数大于10"
fi
```

### 2. if-else语句

```bash
if [ 条件 ]; then
    # 条件为真时执行的命令
else
    # 条件为假时执行的命令
fi
```

示例：
```bash
if [ -f "/path/to/file" ]; then
    echo "文件存在"
else
    echo "文件不存在"
fi
```

### 3. if-elif-else语句

```bash
if [ 条件1 ]; then
    # 条件1为真时执行的命令
elif [ 条件2 ]; then
    # 条件2为真时执行的命令
else
    # 其他情况执行的命令
fi
```

示例：
```bash
if [ "$1" -gt 100 ]; then
    echo "大于100"
elif [ "$1" -gt 50 ]; then
    echo "大于50但小于等于100"
else
    echo "小于等于50"
fi
```

### 4. case语句

用于多条件分支：

```bash
case 变量 in
    模式1)
        # 匹配模式1时执行的命令
        ;;
    模式2)
        # 匹配模式2时执行的命令
        ;;
    *)
        # 默认情况执行的命令
        ;;
esac
```

示例：
```bash
case "$1" in
    "start")
        echo "启动服务"
        ;;
    "stop")
        echo "停止服务"
        ;;
    "restart")
        echo "重启服务"
        ;;
    *)
        echo "用法: $0 {start|stop|restart}"
        ;;
esac
```

## 循环结构

### 1. for循环

基本语法：
```bash
for 变量 in 列表; do
    # 循环体
done
```

示例1：
```bash
for i in 1 2 3 4 5; do
    echo "数字: $i"
done
```

示例2（使用序列）：
```bash
for i in {1..5}; do
    echo "数字: $i"
done
```

示例3（C风格for循环，bash支持）：
```bash
for ((i=1; i<=5; i++)); do
    echo "数字: $i"
done
```

### 2. while循环

```bash
while [ 条件 ]; do
    # 循环体
done
```

示例：
```bash
count=1
while [ $count -le 5 ]; do
    echo "计数: $count"
    count=$((count + 1))
done
```

无限循环：
```bash
while true; do
    # 无限循环体
    if [ 某个条件 ]; then
        break
    fi
done
```

### 3. until循环

与while相反，条件为假时执行循环：

```bash
until [ 条件 ]; do
    # 循环体
done
```

示例：
```bash
count=1
until [ $count -gt 5 ]; do
    echo "计数: $count"
    count=$((count + 1))
done
```

### 4. 循环控制

- `break`：跳出循环
- `continue`：跳过当前循环，进入下一次循环
- `exit`：退出整个脚本

示例：
```bash
for i in {1..10}; do
    if [ $i -eq 5 ]; then
        break  # 当i等于5时跳出循环
    fi
    echo $i
done
```

## 特殊循环技巧

### 1. 遍历文件

```bash
for file in /path/to/*; do
    echo "处理文件: $file"
done
```

### 2. 读取文件行

```bash
while IFS= read -r line; do
    echo "行内容: $line"
done < filename.txt
```

### 3. 遍历命令输出

```bash
for user in $(cut -d: -f1 /etc/passwd); do
    echo "用户: $user"
done
```

## 注意事项

1. 条件判断中的方括号 `[ ]` 前后必须有空格
2. 变量引用最好用双引号括起来，避免空格导致的错误
3. 数值比较使用 `-eq`, `-ne`, `-lt`, `-gt` 等
4. 字符串比较使用 `=`, `!=`, `-z` (空字符串)等
5. 文件测试使用 `-f` (文件存在), `-d` (目录存在)等

掌握这些分支和循环结构后，你就可以编写更复杂、功能更强大的Shell脚本了。