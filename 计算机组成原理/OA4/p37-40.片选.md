好的，我们来一步步分析这份课件，帮你彻底理解这个“CPU与存储器连接”的设计题目。

这道题的核心是：**如何用不同容量、不同类型的存储芯片，拼凑出CPU所要求的地址空间**。

---

### 题目信息梳理

- **CPU规格**：
    - 地址线：16根 (A15 ~ A0)，可寻址空间为 \(2^{16} = 64KB\)。
    - 数据线：8根 (D7 ~ D0)。
    - 控制信号：
        - `MREQ`：低电平有效，表示当前是存储器访问（而非I/O访问）。
        - `R/W`：高电平表示读，低电平表示写。

- **设计要求**：
    1. **地址空间分配**：
        - 最大4K：系统程序区 (ROM)
        - 相邻4K：系统程序工作区 (RAM)
        - 最小16K：用户程序区 (RAM)
    2. **选用芯片类型及数量**。
    3. **画出连接图，特别是片选逻辑**。

- **可用芯片**：
    - ROM: 2K×8位
    - RAM: 多种，如 8K×8位, 4K×4位, 1K×4位等。
    - 门电路：与门、或门、非门等。
    - 译码器：74LS138 (一个3-8译码器)。

---

### 步骤1：地址空间分配（二进制列出）

这是最关键的一步，地址分配决定了如何连接地址线和片选逻辑。

- **总地址范围**：16根地址线，从 `0000 0000 0000 0000` (0x0000) 到 `1111 1111 1111 1111` (0xFFFF)。

我们根据要求从高地址和低地址开始分配：

1.  **最大4K系统程序区 (ROM)**：
    - 4K = \(2^{12}\) Bytes，需要12位地址线 (A11~A0) 进行片内寻址。
    - “最大4K”指的是地址空间的最高4K。
    - 64K的地址范围是 0x0000 ~ 0xFFFF。最高4K的起始地址是 0xF000 (因为 0xFFFF - 0x0FFF = 0xF000)。
    - **地址范围**：`1111 0000 0000 0000` (0xF000) 到 `1111 1111 1111 1111` (0xFFFF)。
    - 在这个范围内，高4位地址 (A15~A12) 始终为 `1111`。

2.  **相邻4K系统程序工作区 (RAM)**：
    - “相邻”指的是紧接着上面的ROM区，向低地址方向相邻。
    - 所以它的地址范围是：0xE000 到 0xEFFF。
    - **地址范围**：`1110 0000 0000 0000` (0xE000) 到 `1110 1111 1111 1111` (0xEFFF)。
    - 在这个范围内，高4位地址 (A15~A12) 始终为 `1110`。

3.  **最小16K用户程序区 (RAM)**：
    - “最小16K”指的是地址空间的最低16K。
    - 16K = \(2^{14}\) Bytes。
    - **地址范围**：`0000 0000 0000 0000` (0x0000) 到 `0011 1111 1111 1111` (0x3FFF)。
    - 在这个范围内，高2位地址 (A15~A14) 始终为 `00`。

**地址空间分配总结表**：

| 区域             | 地址范围（二进制） | 地址范围（十六进制） | A15 A14 A13 A12 |
| :--------------- | :--------------------------------------- | :----------------- | :-------------- |
| 用户程序区 (16K) | `0000 00xx xxxx xxxx` ~ `0011 11xx xxxx xxxx` | 0x0000 ~ 0x3FFF    | 0 0 x x         |
| ... (未使用) ... | ...                                      | ...                | ...             |
| 系统工作区 (4K)  | `1110 00xx xxxx xxxx` ~ `1110 11xx xxxx xxxx` | 0xE000 ~ 0xEFFF    | 1 1 1 0         |
| 系统程序区 (4K)  | `1111 00xx xxxx xxxx` ~ `1111 11xx xxxx xxxx` | 0xF000 ~ 0xFFFF    | 1 1 1 1         |

*注：`x` 代表该位在片内寻址时变化。*

---

### 步骤2：确定芯片的类型和数量

课件里已经给出了方案，我们来看看为什么这么选：

1.  **系统程序区 (4K ROM)**：
    - 需要4K × 8位的ROM。
    - 可用芯片：`2K×8位` ROM。
    - **数量**：2片。
    - **连接方式**：**字扩展**。两片并联，共同组成4K。一片负责低2K (0xF000~0xF7FF)，一片负责高2K (0xF800~0xFFFF)。这需要A11来区分这两片。

2.  **系统程序工作区 (4K RAM)**：
    - 需要4K × 8位的RAM。
    - 可用芯片：`4K×4位` RAM。
    - **数量**：2片。
    - **连接方式**：**位扩展**。两片并联，一片提供高4位数据(D7~D4)，一片提供低4位数据(D3~D0)。它们共同组成一个4K×8位的存储体。两片总是被同时选中。

3.  **用户程序区 (16K RAM)**：
    - 需要16K × 8位的RAM。
    - 可用芯片：`8K×8位` RAM。
    - **数量**：2片。
    - **连接方式**：**字扩展**。一片负责低8K (0x0000~0x1FFF)，一片负责高8K (0x2000~0x3FFF)。用一根片选信号线区分这两片（例如用A13）。

---

### 步骤3：片选逻辑与连接图分析（核心）

片选逻辑的目的是：**确保在CPU访问某个地址时，只有对应区域的芯片被激活**。我们使用74LS138译码器来生成片选信号。

**74LS138 工作原理**：
- 使能端：`G1=1`, `G2A=0`, `G2B=0` 时，译码器工作。
- 输入：C, B, A (通常接高位的地址线)。
- 输出：8个输出端 (Y0~Y7)，**低电平有效**。根据CBA的输入，只有一个输出端为0，其余为1。

**如何分配地址线给译码器？**
- **片内寻址线**：直接连接到存储芯片的地址引脚。例如，一个8K的芯片需要13根地址线 (A12~A0)。
- **片选寻址线**：剩余的高位地址线 (A15~A13) 用于译码，生成片选信号。

课件中的方案非常巧妙，它**没有直接使用A15~A13作为138译码器的CBA输入**，而是将它们进行组合，以精确命中我们分配的、不连续的三块地址区域。

让我们分析课件图中的连接：

1.  **138译码器的输入**：
    - `C = A15`
    - `B = A14`
    - `A = A13`
    - 这意味着138译码器默认将64K空间等分为8个8K的块 (Y0: 0x0000~0x1FFF, Y1: 0x2000~0x3FFF, ..., Y7: 0xE000~0xFFFF)。

2.  **片选逻辑生成**：
    - **用户程序区 (16K)**：地址高两位 A15A14=00。这正好对应138译码器的 Y0 (0x0000~0x1FFF) 和 Y1 (0x2000~0x3FFF) 区域。所以直接使用 `Y0` 和 `Y1` 作为两片8K RAM的片选(CS)。
    - **系统工作区 (4K)**：地址 A15A14A13A12 = 1110。这落在138的Y7 (0xE000~0xFFFF) 这个8K块的前半部分（因为A12=0时是0xE000~0xE7FF，A12=1时是0xE800~0xEFFF）。所以片选逻辑是：`Y7` **并且** `A12=0`（通过一个或非门实现，因为Y7是低有效，需要再结合A12的状态）。
    - **系统程序区 (4K)**：地址 A15A14A13A12 = 1111。这落在138的Y7这个8K块的后半部分。但我们需要将它再细分为两个2K，分别给两片ROM。
        - 第一片ROM (低2K): 地址 A15A14A13A12A11 = 1111 **0**。片选逻辑：`Y7` **并且** `A12=1` **并且** `A11=0`。
        - 第二片ROM (高2K): 地址 A15A14A13A12A11 = 1111 **1**。片选逻辑：`Y7` **并且** `A12=1` **并且** `A11=1`。
        - 课件图中用 `Y7` 和 `A12` 通过一个或非门得到一个中间信号（这个信号在Y7有效且A12=1时为低电平），再用这个中间信号和A11、A11的非分别通过或非门，产生两个ROM的片选。

3.  **控制信号连接**：
    - `MREQ`：连接到138的`G2A`和`G2B`，保证只有在访问存储器时，译码器才工作。
    - `R/W`：连接到所有RAM芯片的`WE`（写使能）引脚。ROM没有写信号。

4.  **数据线连接**：
    - 所有8位宽的芯片（2Kx8 ROM, 8Kx8 RAM）的数据线 (I/O0~I/O7) 直接对应连接到CPU的 D0~D7。
    - 进行位扩展的 4Kx4 RAM，一片接高4位 (D4~D7)，一片接低4位 (D0~D3)。

### 总结

这个设计是一个经典的**存储器扩展**案例，综合运用了：
- **位扩展**：用两片4Kx4拼成4Kx8。
- **字扩展**：用多片芯片扩大地址范围。
- **混合扩展**：同时使用位和字扩展。
- **片选逻辑设计**：使用译码器和简单门电路，灵活地实现不连续的、特定大小的地址空间分配。

理解这个例子的关键在于：**准确进行地址空间分配**，并**深刻理解译码器与门电路如何利用高位地址线来生成精确的片选信号**。希望这个讲解能帮助你彻底弄懂这个知识点！