`diff` 是 Linux/Unix 系统中用于比较文件或目录差异的核心工具，它逐行对比内容并输出差异部分。以下是 `diff` 命令的详细用法及常见场景：

---

### **1. 基本语法**
```bash
diff [选项] 文件1 文件2
diff [选项] 目录1 目录2
```

---

### **2. 常用选项**
| 选项          | 作用                                                                 |
|---------------|----------------------------------------------------------------------|
| `-u`          | 输出**统一格式（unified）**，更易读（适合补丁文件）                  |
| `-c`          | 输出**上下文格式（context）**，显示差异前后的几行                    |
| `-i`          | **忽略大小写**差异                                                   |
| `-w`          | **忽略所有空格**（包括空格和制表符）                                 |
| `-b`          | **忽略空白字符**（空格和制表符的数量变化）                           |
| `-B`          | **忽略空行**差异                                                     |
| `-r`          | **递归比较目录**下的所有文件                                         |
| `-q`          | **仅显示文件是否不同**（不显示具体差异）                             |
| `-N`          | 将**不存在的文件视为空文件**（配合 `-r` 用于目录比较）               |
| `--color`     | 高亮显示差异（需终端支持）                                           |
| `-y`          | **并排显示**差异（需配合 `-W` 指定宽度）                             |
| `-E`          | 忽略行尾空格差异                                                     |

---

### **3. 常见用法示例**
#### **(1) 比较两个文件**
```bash
diff file1.txt file2.txt
```
**输出示例**：
```
5c5
< Hello World  # file1.txt 的第5行
---
> Hello Alice  # file2.txt 的第5行
```
- `<` 表示第一个文件的內容，`>` 表示第二个文件的內容。
- `5c5` 表示第5行有变化（`c`=change，`a`=add，`d`=delete）。

#### **(2) 统一格式输出（适合生成补丁）**
```bash
diff -u file1.txt file2.txt
```
**输出示例**：
```diff
--- file1.txt  2023-01-01 10:00:00
+++ file2.txt  2023-01-02 11:00:00
@@ -2,5 +2,5 @@
 Hello
- World
+ Alice
```

#### **(3) 比较目录**
```bash
diff -r dir1 dir2  # 递归比较目录内容
diff -qr dir1 dir2 # 仅列出差异文件名
```

#### **(4) 忽略空格差异**
```bash
diff -w file1.c file2.c  # 忽略所有空格
diff -b file1.c file2.c  # 忽略空格数量变化
```

#### **(5) 并排显示差异**
```bash
diff -y -W 60 file1.txt file2.txt
```
**输出示例**：
```
Hello World                     | Hello Alice
```

#### **(6) 生成补丁文件**
```bash
diff -u old.txt new.txt > patch.diff
# 应用补丁
patch < patch.diff
```

---

### **4. 高级用法**
#### **(1) 比较命令输出**
```bash
diff <(ls dir1) <(ls dir2)  # 使用进程替换比较两个目录的文件列表
```

#### **(2) 忽略特定行**
通过 `-I` 忽略包含特定模式的行：
```bash
diff -I "Copyright" file1.txt file2.txt  # 忽略含 "Copyright" 的行
```

#### **(3) 仅显示差异行数**
```bash
diff --brief file1.txt file2.txt  # 仅告知是否不同
diff -u file1.txt file2.txt | grep "^[+-]"  # 只显示增减的行
```

---

### **5. 输出格式解析**
| 符号       | 含义                          |
|------------|-------------------------------|
| `<`        | 第一个文件独有的行            |
| `>`        | 第二个文件独有的行            |
| `---`      | 分隔两个文件的差异            |
| `@@ -x,y +a,b @@` | 差异位置（`x,y` 是第一个文件的行范围，`a,b` 是第二个文件的） |

---

### **6. 结合其他工具**
#### **(1) 用 `colordiff` 高亮输出**
```bash
colordiff file1.txt file2.txt  # 需先安装 colordiff
```
或直接使用 `--color`（部分系统支持）：
```bash
diff --color=auto file1.txt file2.txt
```

#### **(2) 用 `vimdiff` 可视化比较**
```bash
vimdiff file1.txt file2.txt  # 在 Vim 中分屏对比
```

#### **(3) 用 `wdiff` 比较单词差异**
```bash
wdiff file1.txt file2.txt  # 高亮显示单词级差异
```

---

### **7. 注意事项**
1. **二进制文件**：`diff` 默认按文本比较，对二进制文件可能输出乱码，可用 `cmp` 命令替代。
2. **大文件优化**：对大文件使用 `--speed-large-files`（部分版本支持）。
3. **符号链接**：`-r` 默认不跟随符号链接，需用 `-L` 选项。

---

### **8. 总结**
- **基础比较**：`diff file1 file2`
- **生成补丁**：`diff -u old new > patch.diff`
- **目录比较**：`diff -r dir1 dir2`
- **忽略空格**：`diff -w file1 file2`
- **彩色输出**：`diff --color` 或 `colordiff`

掌握 `diff` 可以高效定位代码、配置或数据的差异，是开发和系统管理的必备工具！