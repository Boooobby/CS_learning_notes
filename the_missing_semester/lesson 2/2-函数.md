### **函数（Function）的概念与核心要点**

---

#### **1. 什么是函数？**
函数是**封装特定功能的代码块**，具有以下特点：
- **可重复调用**：避免重复编写相同代码。
- **输入输出**：接收参数（输入），返回结果（输出）。
- **作用域**：内部变量通常不影响外部（除非声明为全局）。
- **模块化**：将复杂任务拆解为多个函数，提升代码可读性。

---

#### **2. 函数的组成**
以 Shell 函数为例：
```bash
# 定义函数
function_name() {
    # 函数体
    commands
    [return value]
}

# 调用函数
function_name arg1 arg2
```

---

#### **3. 关键要素**
| 要素          | 说明                                                                 |
|---------------|----------------------------------------------------------------------|
| **函数名**    | 唯一标识符（命名规则同变量，如 `my_func`）                          |
| **参数**      | 通过 `$1`, `$2`... 获取（`$0` 是函数名，`$#` 是参数个数）          |
| **返回值**    | `return` 返回状态码（0-255），`echo` 返回数据                       |
| **局部变量**  | 用 `local` 声明（避免污染全局作用域）                               |

---

#### **4. 函数 vs 脚本 vs 命令**
| 特性          | 函数                  | 脚本                  | 系统命令              |
|---------------|-----------------------|-----------------------|-----------------------|
| **执行方式**  | 当前 Shell 进程执行   | 新建子 Shell 执行     | 独立进程执行          |
| **速度**      | 快（无进程创建开销）  | 慢                   | 中等                  |
| **修改环境**  | 可修改当前 Shell 变量 | 仅影响自身环境        | 不影响调用者环境      |
| **复用性**    | 高（需定义）          | 中（需文件路径）      | 高（全局可用）        |

---

#### **5. 实际示例**
##### **(1) 基础函数**
```bash
# 定义
greet() {
    echo "Hello, $1!"
}

# 调用
greet "Alice"  # 输出：Hello, Alice!
```

##### **(2) 返回值处理**
```bash
is_even() {
    local num=$1
    if (( num % 2 == 0 )); then
        return 0  # 状态码0表示成功（真）
    else
        return 1  # 非0表示失败（假）
    fi
}

# 调用并检查返回值
is_even 4 && echo "偶数" || echo "奇数"
```

##### **(3) 多参数与运算**
```bash
sum() {
    echo $(( $1 + $2 ))
}

result=$(sum 3 5)  # 捕获输出
echo "3 + 5 = $result"
```

---

#### **6. 高级特性**
- **嵌套函数**：函数内调用其他函数。
- **递归**：函数调用自身（需设置终止条件）。
- **导出函数**：用 `export -f func` 使子 Shell 可用。

---

#### **7. 为什么使用函数？**
- **代码复用**：避免重复逻辑。
- **调试方便**：隔离问题范围。
- **可读性**：通过函数名直观表达功能。
- **维护性**：修改只需调整函数内部。

---

#### **8. 注意事项**
1. **先定义后调用**，否则报 `command not found`。
2. **避免命名冲突**：勿与系统命令同名。
3. **慎用全局变量**：推荐 `local` 声明局部变量。
4. **复杂逻辑**：超过 20 行建议拆分为脚本。

---

### **总结**
函数是编程中的**基础抽象单元**，将代码组织为模块化的、可复用的组件。掌握函数是提升脚本质量的关键步骤！