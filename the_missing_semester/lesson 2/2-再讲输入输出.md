在 Linux Shell 中，命令的**输入（Input）**和**输出（Output）**是控制程序数据流的核心机制。理解这些概念对于高效使用命令行至关重要。以下是详细解析：

---

### **一、命令的输入与输出类型**
Linux 命令默认关联三个标准数据流：

| 名称          | 文件描述符 | 默认来源/目标 | 用途                     |
|---------------|------------|---------------|--------------------------|
| **标准输入（stdin）**  | 0          | 键盘          | 程序读取输入数据         |
| **标准输出（stdout）** | 1          | 终端屏幕      | 程序输出正常结果         |
| **标准错误（stderr）** | 2          | 终端屏幕      | 程序输出错误消息         |

---

### **二、输入（Input）的常见来源**
#### 1. **键盘输入（默认）**
   ```bash
   cat  # 输入任意文本，按 Ctrl+D 结束
   ```

#### 2. **文件重定向输入**
   ```bash
   grep "error" < log.txt  # 从文件读取输入
   ```

#### 3. **管道（前一个命令的输出作为输入）**
   ```bash
   ls -l | grep ".txt"  # ls的输出作为grep的输入
   ```

#### 4. **Here Document**
   ```bash
   cat << EOF
   This is a multi-line
   input block.
   EOF
   ```

#### 5. **Here String**
   ```bash
   grep "hello" <<< "hello world"  # 直接传递字符串
   ```

---

### **三、输出（Output）的重定向方式**
#### 1. **覆盖写入文件**
   ```bash
   ls > filelist.txt    # 标准输出写入文件（覆盖）
   ls 1> filelist.txt   # 同上，显式指定文件描述符1
   ```

#### 2. **追加写入文件**
   ```bash
   echo "new line" >> file.txt  # 追加到文件末尾
   ```

#### 3. **重定向标准错误**
   ```bash
   command 2> error.log      # 错误消息写入文件
   command 2>> error.log     # 追加错误消息
   ```

#### 4. **合并标准输出和错误**
   ```bash
   command &> output.log     # 合并stdout和stderr到文件
   command > output.log 2>&1 # 等效写法（经典方式）
   ```

#### 5. **丢弃输出（黑洞设备）**
   ```bash
   command > /dev/null       # 丢弃标准输出
   command 2> /dev/null      # 丢弃错误输出
   command &> /dev/null      # 丢弃所有输出
   ```

---

### **四、管道（Pipeline）的进阶用法**
#### 1. **多命令串联**
   ```bash
   cat access.log | grep "404" | cut -d' ' -f1 | sort | uniq
   ```
   - 流程：读取日志 → 过滤404错误 → 提取IP → 排序 → 去重

#### 2. **处理错误流**
   ```bash
   command1 2>&1 | command2  # 将stderr也通过管道传递
   ```

#### 3. **命名管道（FIFO）**
   ```bash
   mkfifo mypipe
   ls -l > mypipe &  # 后台写入
   cat < mypipe      # 读取内容
   ```

---

### **五、输入输出的高级控制**
#### 1. **输出缓冲控制**
   ```bash
   stdbuf -oL command > output.log  # 行缓冲模式
   ```

#### 2. **文件描述符复制**
   ```bash
   command 3>&1 1> output.log 2>&3  # 保存stdout到文件，同时终端显示错误
   ```

#### 3. **进程替换（替代临时文件）**
   ```bash
   diff <(ls dir1) <(ls dir2)  # 比较两个目录的文件列表
   ```

#### 4. **交互式输入自动化**
   ```bash
   printf "yes\nno\n" | command  # 自动回答交互问题
   ```

---

### **六、实际应用场景**
#### 1. **日志分析**
   ```bash
   grep "ERROR" app.log | tee errors.txt | wc -l
   ```

#### 2. **批量重命名文件**
   ```bash
   ls *.jpg | sed 's/^/prefix_/' | xargs -n2 mv
   ```

#### 3. **实时监控日志**
   ```bash
   tail -f access.log | grep --line-buffered "500"
   ```

#### 4. **数据转换**
   ```bash
   cat data.csv | cut -d',' -f1,3 | tr ',' '\t' > output.tsv
   ```

---

### **七、注意事项**
1. **执行顺序**：管道中的命令是并行执行的（非顺序）。
2. **错误处理**：管道默认只传递stdout，需显式处理stderr。
3. **资源消耗**：长管道可能占用内存，大文件处理建议用临时文件。
4. **信号传递**：`SIGPIPE` 可能导致写入已关闭管道的命令退出。

---

### **八、总结表**
| 操作                | 语法示例                     | 作用                          |
|---------------------|-----------------------------|-------------------------------|
| 输入重定向          | `command < file`           | 从文件读取输入                |
| 输出重定向          | `command > file`           | 覆盖写入文件                  |
| 追加输出            | `command >> file`          | 追加到文件末尾                |
| 错误重定向          | `command 2> error.log`     | 将错误写入文件                |
| 管道                | `cmd1 | cmd2`             | 前者的stdout作为后者的stdin   |
| 合并输出流          | `command &> file`          | stdout和stderr合并写入文件    |
| 丢弃输出            | `command > /dev/null`      | 屏蔽输出                      |
| 多行输入            | `cat <<EOF ... EOF`        | 嵌入多行文本                  |

掌握输入输出重定向和管道，是成为Linux命令行高手的关键一步！