好的，我们进入 **Section 2: Preliminaries and Backgrounds**（预备知识与背景）。

这一部分虽然通常不包含新颖的Idea，但它是你理解后面理论大厦（Section 3）的地基。特别是你提到要搞懂数学，这一节给出了所有必要的符号定义。

作者主要介绍了三个核心概念：

---

### 1. 连续时间扩散模型（Continuous-Time Diffusion Model）
这是目前理论分析最常用的框架，主要基于 **随机微分方程（SDE）**。

*   **前向过程（加噪）**：
    用一个SDE描述图像变成噪声的过程：
    $$ dx = h(x, t)dt + g(t)dw $$
    *   $x$：图片。
    *   $t$：时间（从0到1，1代表全是噪声）。
    *   $h(x, t)$：漂移项（Drift），你可以理解为数据的“均值”怎么变。
    *   $g(t)$：扩散项（Diffusion），控制加多少噪声。
    *   $dw$：布朗运动（随机噪声源）。

*   **反向过程（去噪）** —— **这就是防御的核心！**
    这是一条著名的公式（Anderson, 1982），只要知道分数值 $\nabla \log p_t(x)$，就可以时间倒流：
    $$ d\hat{x} = [h(\hat{x}, t) - g(t)^2 \nabla_{\hat{x}} \log p_t(\hat{x})] dt + g(t) d\bar{w} $$
    *   **$\nabla_{\hat{x}} \log p_t(\hat{x})$**：这就是**分数函数（Score Function）**。
    *   **关键点**：这个公式告诉我们，要从噪声 $\hat{x}_T$ 变回数据 $\hat{x}_0$，我们需要知道每一步的“分数”（即数据密度的梯度）。
    *   **关联**：DensePure 就是利用这个反向SDE，从对抗样本（当作中间态）倒推回清洁样本。

### 2. 离散时间扩散模型（Discrete-Time Diffusion Model / DDPM）
这是代码实现时实际用的模型（因为计算机不能处理连续时间）。

*   **前向**：把连续的时间切成 $N$ 步（比如1000步）。每一步加一点高斯噪声。
    $$ q(x_t | x_{t-1}) = \mathcal{N}(...) $$
*   **反向**：训练一个神经网络 $\epsilon_\theta(x_t, t)$ 来预测噪声。
    $$ p_\theta(x_{t-1} | x_t) = \mathcal{N}(x_{t-1}; \mu_\theta, \Sigma_\theta) $$
    *   这里的 $\mu_\theta$ 是均值，由神经网络预测。
    *   **关键点**：DensePure 在实际跑代码时用的是这个 DDPM 框架。

### 3. 随机平滑（Randomized Smoothing）
这是 **可认证鲁棒性（Certified Robustness）** 的基石工具。

*   **操作**：
    1.  把分类器 $f$ 变成平滑分类器 $g$。
    2.  怎么变？给输入 $x$ 加上高斯噪声 $\epsilon$，看 $f(x+\epsilon)$ 的表现。
    3.  公式：
        $$ g(x) = \arg\max_c P_{\epsilon}(f(x+\epsilon) = c) $$
    *   翻译：给 $x$ 加噪声后，大多数时候可以被分类成哪个类别 $c$，那个类别就是 $g(x)$ 的输出。

*   **认证半径（Certified Radius）**：
    著名的 Cohen et al. (2019) 定理。如果我知道 $g(x)$ 是类别 A 的概率 $p_A$，且 $p_A > p_B$（第二名的概率），那么我可以算出一个半径 $R$：
    $$ R = \frac{\sigma}{2} (\Phi^{-1}(p_A) - \Phi^{-1}(p_B)) $$
    *   **只要攻击 $\delta$ 的 $L_2$ 范数小于 $R$，预测结果 $g(x)$ 就绝对不会变。**

---

### 总结 Section 2 的作用

这一节实际上是在为你拼凑 **DensePure 的武器库**：

1.  **武器1（SDE）**：用来做 Section 3 的理论推导（因为连续数学好推导）。
2.  **武器2（DDPM）**：用来做 Section 4 和 5 的实际算法实现（代码好写）。
3.  **武器3（Randomized Smoothing）**：用来作为**裁判**，计算出那个具体的“安全半径 $R$”，证明 DensePure 真的很强。

**对于你的阅读重点：**
*   如果你想搞懂后面的理论证明，多看 SDE 那部分。
*   如果你想复现代码，多看 DDPM 那部分（特别是公式里 $\mu_\theta$ 怎么算的）。
*   如果你想理解为什么要加高斯噪声做测试，多看 Randomized Smoothing 那部分。