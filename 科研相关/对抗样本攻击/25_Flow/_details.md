## details

---

### 概率路径和速度场

概率路径就是定义了图片在每一个时刻的分布，一般定义成高斯分布

如一个路径 $p_t$，就是图片在t时刻的一个高斯分布（均值和方差都是t的函数 所以t时刻的分布是确定的）

这个概率路径描述了图片的变化过程，而这个变化过程我们是可以定义的，比如作者就定义了一个OT直线路径变化

而flow模型学习的速度场（向量场）就是这个概率路径的“导数”（并非真正的导数），其表明空间中每一个点在t时刻移动的方向和速度（概率路径描述位置，速度场描述运动）

flow matching就是强大在可以随意定义概率路径

最后只需满足边界条件：初始为纯高斯噪声，最终为真实图片分布

---

### 流与ODE

有向量场 $v_t$，就可以定义一个流 $\phi_t$。这个映射描述了一个样本点 $x$ 随时间移动的轨迹，其遵循以下 ODE：

$$\frac{d}{dt}\phi_t(x) = v_t(\phi_t(x)), \quad \phi_0(x) = x$$

这个流定义了每一个粒子（像素点）的具体路径，这里的向量场就是流的导数。所以向量场让我们知道在每一个时刻样本中的每一个点应该如何变化，0时刻自然就是自己本身

**总结**：
- $v_t$ (向量场)：是因，是神经网络要学的“导航指令”
- $\phi_t$ (流/轨迹)：是果，是样本点实际跑出来的路线
- $p_t$ (分布路径)：是宏观表现，描述了防御模型净化过程中，所有可能样本的整体分布如何变回干净图像

---

### Theorem 3

设计路径时最常用的数学工具，只要定义了条件路径和流映射（条件路径定义完自然就定义完了流映射）
- 条件路径 ($p_t(x|x_1)$)：我们规定在 $t$ 时刻，以 $x_1$ 为目标的点群服从均值为 $\mu_t$、标准差为 $\sigma_t$ 的正态分布（均值和方差自己设定）
- 流映射 ($\psi_t(x)$)：这是具体的粒子移动“说明书”。它把一个标准噪声点 $x$ 变成 $t$ 时刻的点：
$$\psi_t(x) = \sigma_t(x_1)x + \mu_t(x_1)$$

定义的这个移动过程，其对应的唯一向量场 $u_t$ 公式为：
$$u_t(x|x_1) = \frac{\sigma'_t(x_1)}{\sigma_t(x_1)}(x - \mu_t(x_1)) + \mu'_t(x_1)$$

其中 $\sigma'_t$ 和 $\mu'_t$ 分别是标准差和均值对时间 $t$ 的导数

就是对流求导，得到的就是这个向量

---

### 训练

直接计算全局向量场极其困难，而论文证明了用边缘分布来训练，在期望上等同于训练全局向量场（直接用样本进行回归，无需模拟）
