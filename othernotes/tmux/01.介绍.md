`tmux` (Terminal Multiplexer) 绝对是做深度学习科研的**神器**。

想象一下：如果你直接在 SSH 里跑代码（比如 `python train.py`），一旦你合上 Mac 盖子、或者学校 WiFi 抖一下、或者 VPN 断了，SSH 连接一断，你的程序就会立马被“杀死”，跑了一整晚的模型就白费了。

`tmux` 就像是在服务器上开了一个**“永不关机的虚拟显示器”**。你可以在里面跑程序，然后关掉电脑去睡觉。第二天连上服务器，打开这个“显示器”，程序还在那里跑，进度条还在动，一行日志都没丢。

下面是针对科研场景最实用的 `tmux` 指南：

---

### 1. 核心概念：前缀键 (Prefix Key)

`tmux` 的所有快捷键都需要先按一个“前缀”。
默认是 **`Ctrl + B`**。

* **操作逻辑**：按住 `Ctrl` 不放，按一下 `b`，**两手都松开**，然后再按下一个功能键。
* *（下文我会用 `Prefix` 代指 `Ctrl + B`）*

---

### 2. 最常用的“科研闭环”流程

这是你未来每天都要重复几十次的操作，请务必记熟：

#### 第一步：新建一个会话（Session）

给你的任务起个好名字很重要，不然以后找不到哪个是哪个。

```bash
# 新建一个叫 "resnet_train" 的会话
tmux new -s resnet_train

```

*你会发现进入了一个底部有绿色状态条的新界面。*

#### 第二步：运行代码

在这个界面里，和平时一样操作：

```bash
conda activate my_env
python train.py

```

#### 第三步：挂起/离开（Detach）

代码跑起来了，你想退出去干别的（或者合盖子走人）。

* 按键：**`Prefix`** (松手) -> **`d`**
* *记忆口诀：d = detach (分离)*
* 你会回到原来的终端界面，提示 `[detached]`。此时程序在后台继续飞奔。

#### 第四步：回来/重连（Attach）

第二天早上，你连上 SSH，想看看跑得咋样了。

```bash
# 查看当前有哪些后台会话
tmux ls

# 回到刚才那个 "resnet_train" 会话
tmux attach -t resnet_train

```

*现在你又回到了昨晚的那个界面，就像你从未离开过一样。*

---

### 3. 进阶耍帅：分屏查看 (Split Pane)

用 L20 做实验时，最经典的布局是：**左边跑代码，右边监控显卡**。你不需要开两个 iTerm2 窗口，直接把 tmux 切开就行。

1. 进入 tmux 会话。
2. **左右切分**：按 **`Prefix`** -> **`%`** (Shift + 5)。
3. **上下切分**：按 **`Prefix`** -> **`"`** (双引号键)。
4. **光标切换**：按 **`Prefix`** -> **`方向键`** (上下左右跳跃)。

**推荐布局：**

* 左边窗格：跑 `python train.py`
* 右边窗格：跑 `watch -n 1 nvidia-smi` (实时监控显存)

---

### 4. 两个新手必坑（请注意！）

#### 坑一：怎么翻看以前的日志？（鼠标滚轮滚不动）

在 tmux 里，你直接用鼠标滚轮往上翻，翻的是 iTerm2 的历史，而不是 tmux 里面的历史。
**解决方法（开启鼠标支持）：**
第一次进 tmux 时，输入这行命令（一次永久生效）：

```bash
echo "set -g mouse on" >> ~/.tmux.conf
tmux source-file ~/.tmux.conf

```

设置好后，你就可以直接用鼠标滚轮在 tmux 里上下翻页，甚至可以用鼠标点击来切换分屏了！

#### 坑二：怎么彻底关闭会话？

如果你的代码跑完了，或者你想杀掉这个任务：

1. 在 tmux 里面输入 `exit` 或者按 `Ctrl + D`。
2. 当最后一个分屏被关闭，整个会话就会结束。

如果你在外面（detach 状态）想杀掉某个卡死的会话：

```bash
# 杀掉名为 resnet_train 的会话
tmux kill-session -t resnet_train

```

---

### 总结 Cheat Sheet

建议把这段抄在你的便利贴上：

* **进**：`tmux new -s <名字>`
* **出**（保留后台）：`Ctrl+B` 然后 `d`
* **回**：`tmux attach -t <名字>`
* **分屏**：`Ctrl+B` 然后 `%`
* **查**：`tmux ls`

现在，你可以试着在你的服务器上创建一个叫 `hello` 的 session，在里面输个 `top` 命令看着它跑，然后 detach 退出来，再 attach 回去试试看？