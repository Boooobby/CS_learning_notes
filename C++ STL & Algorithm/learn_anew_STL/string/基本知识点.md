# C++中的string类详细学习指南

C++中的`string`类是标准库提供的用于处理字符串的强大工具，它比C风格的字符数组(`char[]`)更安全、更方便。下面我将详细介绍`string`类的各个方面。

## 1. 头文件和命名空间

```cpp
#include <string>  // 必须包含的头文件
using std::string; // 使用std命名空间中的string
```

## 2. 字符串的声明和初始化

```cpp
string s1;             // 默认初始化，空字符串
string s2 = "hello";    // 拷贝初始化
string s3("world");     // 直接初始化
string s4(5, 'a');      // 包含5个'a'的字符串 "aaaaa"
string s5(s2);          // 拷贝构造，s5是s2的副本
string s6 = s2 + s3;    // 通过连接初始化 "helloworld"
```

## 3. 基本操作

### 3.1 输入输出

```cpp
string s;
cin >> s;       // 读取一个单词(遇到空白停止)
getline(cin, s); // 读取一行(包括空格)

cout << s << endl; // 输出字符串
```

### 3.2 访问字符

```cpp
string s = "hello";
char c1 = s[0];     // 'h'，不检查越界
char c2 = s.at(1);  // 'e'，会检查越界(越界抛出out_of_range异常)

// 使用迭代器访问
for(auto it = s.begin(); it != s.end(); ++it) {
    cout << *it;
}
```

### 3.3 字符串比较

```cpp
string s1 = "apple", s2 = "banana";
if(s1 == s2) { /* 相等 */ }
if(s1 < s2)  { /* 字典序比较 */ }
if(s1.compare(s2) < 0) { /* 同上 */ }
```

## 4. 常用成员函数

### 4.1 容量相关

```cpp
string s = "hello";
s.size();       // 或length()，返回字符数 5
s.empty();      // 是否为空字符串
s.capacity();   // 当前分配的存储空间大小
s.reserve(100); // 预留至少100个字符的空间
s.shrink_to_fit(); // 减少capacity到size
```

### 4.2 修改操作

```cpp
string s = "hello";
s += " world";      // 追加 "hello world"
s.append("!!");     // "hello world!!"
s.push_back('!');   // 追加单个字符
s.insert(5, " dear"); // 在位置5插入 "hello dear world!!!"
s.erase(5, 5);      // 删除从5开始的5个字符
s.replace(6, 5, "beautiful"); // 替换从6开始的5个字符
s.clear();          // 清空字符串
```

### 4.3 子串和查找

```cpp
string s = "hello world";
string sub = s.substr(6, 5); // 从6开始取5个字符 "world"

size_t pos = s.find("world"); // 返回首次出现的位置6
pos = s.find("abc");         // 找不到返回string::npos

pos = s.rfind("l");          // 从后向前找，返回最后一个'l'的位置9
pos = s.find_first_of("aeiou"); // 查找任何元音首次出现的位置1('e')
pos = s.find_last_not_of("dlorw "); // 查找最后一个不在集合中的字符4('o')
```

## 5. 字符串与数值转换(C++11起)

```cpp
// 字符串转数值
string s1 = "123";
int i = stoi(s1);        // string to int
double d = stod("3.14"); // string to double

// 数值转字符串
string s2 = to_string(42);    // "42"
string s3 = to_string(3.1415); // "3.141500"
```

## 6. 字符串与C风格字符串

```cpp
string s = "hello";
const char* p = s.c_str(); // 获取C风格字符串(以'\0'结尾)

char buf[100];
s.copy(buf, 3); // 复制前3个字符到buf(不添加'\0')
```

## 7. 高级特性

### 7.1 原始字符串字面量(C++11)

```cpp
string path = R"(C:\Program Files\MyApp)"; // 不需要转义反斜杠
string html = R"delimiter(
<html>
<body>
  <p>Hello World!</p>
</body>
</html>
)delimiter"; // 多行字符串
```

### 7.2 字符串视图(C++17)

```cpp
#include <string_view>
std::string_view sv = "Hello"; // 不拥有字符串，只提供视图
```

## 8. 性能考虑

1. `operator+=`通常比多次`+`更高效
2. 预分配空间(`reserve()`)可以减少多次追加时的重新分配
3. 传递大字符串时，考虑使用`const string&`避免拷贝

## 9. 示例代码

```cpp
#include <iostream>
#include <string>
using namespace std;

int main() {
    string name;
    cout << "Enter your name: ";
    getline(cin, name);
    
    string greeting = "Hello, " + name + "!";
    cout << greeting << endl;
    
    cout << "Your name has " << name.length() << " characters." << endl;
    
    if(name.find("Smith") != string::npos) {
        cout << "Are you related to the Smith family?" << endl;
    }
    
    string initials;
    initials += toupper(name[0]);
    size_t space_pos = name.find(' ');
    if(space_pos != string::npos) {
        initials += toupper(name[space_pos + 1]);
    }
    cout << "Your initials are: " << initials << endl;
    
    return 0;
}
```

希望这份详细的指南能帮助你全面掌握C++中的`string`类！如果需要更深入了解某个特定方面，可以进一步探讨。